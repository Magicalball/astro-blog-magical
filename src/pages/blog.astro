---
import BaseLayout from "../layouts/BaseLayout.astro";
import VirtualBlogList from "../components/VirtualBlogList.tsx";
import { normalizePost } from "../utils/getPosts";
import { getComparableUtcTime } from "../utils/validation";

const pageTitle = "文章";
const globResult = import.meta.glob("./posts/**/*.{md,mdx}");
const allPosts = await Promise.all(Object.values(globResult).map(fn => fn()));
const normalized = allPosts.map((p: any) => normalizePost(p));
const sortedPosts = normalized
  .slice()
  .sort((a, b) => getComparableUtcTime(b.pubDate) - getComparableUtcTime(a.pubDate));

// 使用虚拟滚动优化性能
---

<BaseLayout pageTitle={pageTitle}>
  <p>都有些什么呀~</p>

  <VirtualBlogList 
    posts={sortedPosts} 
    client:visible 
  />
</BaseLayout>
