---
import BaseLayout from "./BaseLayout.astro";
import { validateFrontmatter } from "../utils/validation";
import { resolveCoverImage } from "../utils/assets";
const { frontmatter } = Astro.props;
const fm = validateFrontmatter(frontmatter);
const cover = resolveCoverImage(fm.coverImage);
---

<meta charset="UTF-8" />
<BaseLayout
  seoTitle={fm.title}
  seoDescription={fm.description}
  seoAuthor={fm.author}
  seoOgImage={cover}
>
  <main class="post-layout">
    <article class="post-article">
      <header class="post-header">
        <h1 class="post-title">{fm.title}</h1>
        <div class="post-meta">
          <div class="post-meta-main">
            <p class="post-meta-item post-date">
              发布于 {fm.pubDate.toString().slice(0, 10)}
            </p>
            <p class="post-meta-item post-author">作者 {fm.author}</p>
          </div>

          {(fm.tags && fm.tags.length > 0) && (
            <div class="post-tags">
              <span class="post-tags-label">标签</span>
              <div class="post-tags-list">
                {(fm.tags || []).map((tag: string) => (
                  <a class="post-tag" href={`/tags/${tag}`}>
                    {tag}
                  </a>
                ))}
              </div>
            </div>
          )}
        </div>

        {fm.description && (
          <p class="post-description">
            <em>{fm.description}</em>
          </p>
        )}
      </header>

      <section class="post-content markdown-body">
        <slot />
      </section>
    </article>
  </main>
</BaseLayout>

<style>
  .post-layout {
    padding: 24px 16px 80px;
  }

  .post-article {
    margin: 0 auto;
    max-width: 800px;
    background-color: #ffffff;
    border-radius: 12px;
    padding: 32px 24px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  }

  :global(.dark) .post-article {
    background-color: #1f1f1f;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  .post-header {
    margin-bottom: 2rem;
  }

  .post-title {
    margin: 0 0 1rem;
    font-size: 2.2rem;
    line-height: 1.3;
  }

  .post-meta {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 0.75rem 1.5rem;
    font-size: 0.9rem;
    color: #666666;
  }

  :global(.dark) .post-meta {
    color: #aaaaaa;
  }

  .post-meta-main {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem 1.5rem;
  }

  .post-meta-item {
    margin: 0;
  }

  .post-description {
    margin: 1rem 0 0;
    font-size: 0.95rem;
    color: #555555;
  }

  :global(.dark) .post-description {
    color: #cccccc;
  }

  .post-tags {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .post-tags-label {
    font-size: 0.9rem;
    color: #888888;
  }

  :global(.dark) .post-tags-label {
    color: #bbbbbb;
  }

  .post-tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .post-tag {
    text-decoration: none;
    color: #0070f3;
    padding: 4px 10px;
    border-radius: 999px;
    background-color: rgba(0, 112, 243, 0.08);
    border: 1px solid rgba(0, 112, 243, 0.25);
    font-size: 0.85rem;
  }

  .post-tag:hover {
    text-decoration: underline;
  }

  :global(.dark) .post-tag {
    color: #66b3ff;
    background-color: rgba(102, 179, 255, 0.12);
    border-color: rgba(102, 179, 255, 0.4);
  }

  :global(.dark) .post-tag:hover {
    text-decoration: underline;
  }

  .post-content {
    text-align: left;
  }

  /* Markdown 正文排版（无动画，专注阅读） */
  .markdown-body {
    font-size: 1rem;
    line-height: 1.75;
    color: #222222;
  }

  :global(.dark) .markdown-body {
    color: #e0e0e0;
  }

  .markdown-body p {
    margin: 0 0 1.2em;
  }

  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    margin: 1.8em 0 0.8em;
    line-height: 1.4;
  }

  .markdown-body h1 {
    font-size: 1.8rem;
  }

  .markdown-body h2 {
    font-size: 1.5rem;
  }

  .markdown-body h3 {
    font-size: 1.3rem;
  }

  .markdown-body h4 {
    font-size: 1.15rem;
  }

  .markdown-body ul,
  .markdown-body ol {
    margin: 0 0 1.2em;
    padding-left: 1.5em;
  }

  .markdown-body li + li {
    margin-top: 0.25em;
  }

  .markdown-body a {
    color: #0070f3;
    text-decoration: none;
  }

  .markdown-body a:hover {
    text-decoration: underline;
  }

  :global(.dark) .markdown-body a {
    color: #66b3ff;
  }

  .markdown-body code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      "Liberation Mono", "Courier New", monospace;
    font-size: 0.95em;
    background-color: #f5f5f5;
    padding: 0.15em 0.4em;
    border-radius: 4px;
  }

  :global(.dark) .markdown-body code {
    background-color: #2a2a2a;
  }

  .markdown-body pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      "Liberation Mono", "Courier New", monospace;
    font-size: 0.95em;
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 0 0 1.5em;
  }

  :global(.dark) .markdown-body pre {
    background-color: #262626;
  }

  .markdown-body pre code {
    background: none;
    padding: 0;
  }

  .markdown-body blockquote {
    margin: 0 0 1.5em;
    padding: 0.75em 1em;
    border-left: 4px solid #dddddd;
    background-color: #fafafa;
    color: #555555;
  }

  :global(.dark) .markdown-body blockquote {
    border-left-color: #555555;
    background-color: #222222;
    color: #cccccc;
  }

  .markdown-body img {
    max-width: 100%;
    display: block;
    margin: 1.5rem auto;
    border-radius: 4px;
  }

  .markdown-body hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 2rem 0;
  }

  :global(.dark) .markdown-body hr {
    border-top-color: #444444;
  }

  @media (max-width: 768px) {
    .post-layout {
      padding: 0 0 56px;
    }

    .post-article {
      max-width: none;
      margin: 0;
      border-radius: 0;
      box-shadow: none;
      padding: 24px 16px;
    }

    .post-title {
      font-size: 1.8rem;
    }
  }
</style>
